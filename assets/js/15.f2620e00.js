(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{199:function(e,t,r){"use strict";r.r(t);var n=r(6),v=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"secret-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secret-management"}},[e._v("#")]),e._v(" Secret management")]),e._v(" "),t("ul",[t("li",[e._v("Simple to install via npm ("),t("code",[e._v("npm i -g @naturalcycles/nodejs-lib")]),e._v(" or\n"),t("code",[e._v("yarn global add @naturalcycles/nodejs-lib")]),e._v(")")]),e._v(" "),t("li",[e._v("Scripts immediately available in global $PATH (if installed globally)")]),e._v(" "),t("li",[e._v("Opinionated, based on directory structure conventions")]),e._v(" "),t("li",[e._v("Light (few dependencies)")]),e._v(" "),t("li",[e._v("Exposes Node.js API (with types) so you can programmaticaly use same function that CLI provides\n(only if you want to)")])]),e._v(" "),t("h1",{attrs:{id:"encryption"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#encryption"}},[e._v("#")]),e._v(" Encryption")]),e._v(" "),t("p",[e._v("Based on\n"),t("a",{attrs:{href:"http://vancelucas.com/blog/stronger-encryption-and-decryption-in-node-js/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stronger Encryption and Decryption in Node.js"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[t("code",[e._v("aes-256-cbc")]),e._v(" algorithm is used by default.")]),e._v(" "),t("p",[e._v("Random initialization vector (IV) is used, prepended to the encrypted file (first 16 bytes).")]),e._v(" "),t("p",[e._v("Encrypted file is stored in binary format (Buffer), containing concatenated (byte range in\nbrackets):")]),e._v(" "),t("ul",[t("li",[e._v("IV (0, 16)")]),e._v(" "),t("li",[e._v("Payload (16, ...)")])]),e._v(" "),t("h1",{attrs:{id:"cli-commands"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cli-commands"}},[e._v("#")]),e._v(" CLI commands")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("secrets-gen-key")]),e._v(": Generate a "),t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(" to be used for encryption/decryption of\nsecret files.")]),e._v(" "),t("li",[t("code",[e._v("secrets-encrypt")]),e._v(": Encrypt all files (except already encrypted "),t("code",[e._v("*.enc")]),e._v(") in "),t("code",[e._v("./secret")]),e._v(" folder.\n"),t("code",[e._v(".enc")]),e._v(" is added to the file.")]),e._v(" "),t("li",[t("code",[e._v("secrets-decrypt")]),e._v(": Decrypt all encrypted files ("),t("code",[e._v("*.enc")]),e._v(") in "),t("code",[e._v("./secret")]),e._v(" folder. "),t("code",[e._v(".enc")]),e._v(" extension is\nremoved after encryption, files are overwritten.")])]),e._v(" "),t("h1",{attrs:{id:"key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#key"}},[e._v("#")]),e._v(" Key")]),e._v(" "),t("p",[e._v("Commands "),t("code",[e._v("secrets-encrypt")]),e._v(" and "),t("code",[e._v("secrets-decrypt")]),e._v(" need a key to perform an operation (generate it\nwith "),t("code",[e._v("secrets-gen-key")]),e._v(" first time).")]),e._v(" "),t("p",[e._v("Key can be passed in one of the following ways, in order of preference:")]),e._v(" "),t("ol",[t("li",[t("code",[e._v("--encKey myKey")]),e._v(" CLI argument (overrides everything else)")]),e._v(" "),t("li",[t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(" environment variable.")]),e._v(" "),t("li",[t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(" in "),t("code",[e._v(".env")]),e._v(" file in your project folder ("),t("code",[e._v("cwd")]),e._v(").")])]),e._v(" "),t("p",[e._v("Also, you can provide e.g "),t("code",[e._v("--encKeyVar SECRET_ENCRYPTION_KEY_B")]),e._v(" - name of env variable to read key\nfrom.")]),e._v(" "),t("h1",{attrs:{id:"usage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[e._v("#")]),e._v(" Usage")]),e._v(" "),t("p",[t("em",[e._v("All examples are for global installation. For local installations prepend the command with "),t("code",[e._v("yarn")]),e._v("\n(or "),t("code",[e._v("npm run")]),e._v(").")])]),e._v(" "),t("h3",{attrs:{id:"secrets-gen-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secrets-gen-key"}},[e._v("#")]),e._v(" secrets-gen-key")]),e._v(" "),t("p",[e._v("Generate a "),t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(" to be used for encryption/decryption of secret files.")]),e._v(" "),t("p",[e._v("Keep it secret, provide as env variable "),t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(" to the following commands.")]),e._v(" "),t("h3",{attrs:{id:"secrets-encrypt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secrets-encrypt"}},[e._v("#")]),e._v(" secrets-encrypt")]),e._v(" "),t("p",[e._v("Encrypt all files (except already encrypted "),t("code",[e._v("*.enc")]),e._v(") in "),t("code",[e._v("./secret")]),e._v(" folder (and its subfolder).\n"),t("code",[e._v(".enc")]),e._v(" is added to the file.")]),e._v(" "),t("p",[e._v("Example: "),t("code",[e._v("secret1.json")]),e._v(" will become "),t("code",[e._v("secret1.json.enc")]),e._v(".")]),e._v(" "),t("p",[e._v("Options:")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("--pattern")]),e._v(" - directory (pattern) to encrypt (default to "),t("code",[e._v("./secret")]),e._v("). Can provide many like\n"),t("code",[e._v("--pattern p1 p2")]),e._v(" or "),t("code",[e._v("--pattern p1 --pattern p2")]),e._v(". Supports "),t("code",[e._v("globby")]),e._v(" pattern, e.g\n"),t("code",[e._v("--pattern ./secret/**/*.txt")]),e._v(".")]),e._v(" "),t("li",[t("code",[e._v("--encKey")]),e._v(" - provide encryption key")]),e._v(" "),t("li",[t("code",[e._v("--encKeyVar")]),e._v(" - read encryption key from env variable with this name (default\n"),t("code",[e._v("SECRET_ENCRYPTION_KEY")]),e._v(").")]),e._v(" "),t("li",[t("code",[e._v("--algorithm")]),e._v(" - encryption algorithm to use (default "),t("code",[e._v("aes-256-cbc")]),e._v(").")]),e._v(" "),t("li",[t("code",[e._v("--del")]),e._v(" - delete source files after successful encryption. Be careful!")]),e._v(" "),t("li",[t("code",[e._v("help")]),e._v(" - list possible options")])]),e._v(" "),t("h3",{attrs:{id:"secrets-decrypt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#secrets-decrypt"}},[e._v("#")]),e._v(" secrets-decrypt")]),e._v(" "),t("p",[e._v("Decrypt all encrypted files ("),t("code",[e._v("*.enc")]),e._v(") in "),t("code",[e._v("./secret")]),e._v(" folder (and its subfolders). "),t("code",[e._v(".enc")]),e._v(" extension is\nremoved after encryption, files are overwritten.")]),e._v(" "),t("p",[e._v("Example: "),t("code",[e._v("secret1.json.enc")]),e._v(" will become "),t("code",[e._v("secret1.json")]),e._v(".")]),e._v(" "),t("p",[e._v("Options: same as "),t("code",[e._v("secrets-encrypt")]),e._v(".")]),e._v(" "),t("p",[e._v("Except "),t("code",[e._v("--dir")]),e._v(" is used instead of "),t("code",[e._v("--pattern")]),e._v(". Example: "),t("code",[e._v("--dir ./secret")]),e._v(" will decrypt all\n"),t("code",[e._v("./secret/**/*.enc")]),e._v(".")]),e._v(" "),t("h1",{attrs:{id:"gitignore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitignore"}},[e._v("#")]),e._v(" .gitignore")]),e._v(" "),t("p",[e._v("Use "),t("a",{attrs:{href:"https://github.com/NaturalCycles/dev-lib",target:"_blank",rel:"noopener noreferrer"}},[e._v("dev-lib"),t("OutboundLink")],1),e._v(" and "),t("code",[e._v("yarn update-from-dev-lib")]),e._v(".")]),e._v(" "),t("p",[e._v("Otherwise, this is the right config for "),t("code",[e._v(".gitignore")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# All secrets are ignored, except encrypted\n/secret/**/*.*\n!/secret/**/*.enc\n")])])])])}),[],!1,null,null,null);t.default=v.exports}}]);