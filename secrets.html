<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Secret management | nodejs-lib</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/nodejs-lib/assets/css/0.styles.2bbbbdf1.css" as="style"><link rel="preload" href="/nodejs-lib/assets/js/app.b32b6a46.js" as="script"><link rel="preload" href="/nodejs-lib/assets/js/2.23454914.js" as="script"><link rel="preload" href="/nodejs-lib/assets/js/15.f2620e00.js" as="script"><link rel="prefetch" href="/nodejs-lib/assets/js/10.b311f070.js"><link rel="prefetch" href="/nodejs-lib/assets/js/11.f6fae681.js"><link rel="prefetch" href="/nodejs-lib/assets/js/12.c8e173fe.js"><link rel="prefetch" href="/nodejs-lib/assets/js/13.fc07e4fa.js"><link rel="prefetch" href="/nodejs-lib/assets/js/14.d4814555.js"><link rel="prefetch" href="/nodejs-lib/assets/js/16.5b91f6c9.js"><link rel="prefetch" href="/nodejs-lib/assets/js/17.46546f60.js"><link rel="prefetch" href="/nodejs-lib/assets/js/18.13a7664e.js"><link rel="prefetch" href="/nodejs-lib/assets/js/19.6b3f8047.js"><link rel="prefetch" href="/nodejs-lib/assets/js/3.4a6755ce.js"><link rel="prefetch" href="/nodejs-lib/assets/js/4.03071ad0.js"><link rel="prefetch" href="/nodejs-lib/assets/js/5.d2f70f50.js"><link rel="prefetch" href="/nodejs-lib/assets/js/6.2399b5ae.js"><link rel="prefetch" href="/nodejs-lib/assets/js/7.95714517.js"><link rel="prefetch" href="/nodejs-lib/assets/js/8.a8b22878.js"><link rel="prefetch" href="/nodejs-lib/assets/js/9.1561aaaf.js">
    <link rel="stylesheet" href="/nodejs-lib/assets/css/0.styles.2bbbbdf1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nodejs-lib/" class="home-link router-link-active"><!----> <span class="site-name">nodejs-lib</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/NaturalCycles/nodejs-lib" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/NaturalCycles/nodejs-lib" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodejs-lib/" aria-current="page" class="sidebar-link">nodejs-lib</a></li><li><a href="/nodejs-lib/validation.html" class="sidebar-link">Validation</a></li><li><a href="/nodejs-lib/http.html" class="sidebar-link">http</a></li><li><a href="/nodejs-lib/fs.html" class="sidebar-link">fs</a></li><li><a href="/nodejs-lib/stream.html" class="sidebar-link">Stream</a></li><li><a href="/nodejs-lib/colors.html" class="sidebar-link">Colors</a></li><li><a href="/nodejs-lib/debug.html" class="sidebar-link">Debug</a></li><li><a href="/nodejs-lib/exec.html" class="sidebar-link">Exec</a></li><li><a href="/nodejs-lib/secrets.html" aria-current="page" class="active sidebar-link">Secret management</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs-lib/security.html" class="sidebar-link">Security</a></li><li><a href="/nodejs-lib/script.html" class="sidebar-link">Script</a></li><li><a href="/nodejs-lib/slack.html" class="sidebar-link">Slack</a></li><li><a href="/nodejs-lib/other.html" class="sidebar-link">Other</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="secret-management"><a href="#secret-management" class="header-anchor">#</a> Secret management</h1> <ul><li>Simple to install via npm (<code>npm i -g @naturalcycles/nodejs-lib</code> or
<code>yarn global add @naturalcycles/nodejs-lib</code>)</li> <li>Scripts immediately available in global $PATH (if installed globally)</li> <li>Opinionated, based on directory structure conventions</li> <li>Light (few dependencies)</li> <li>Exposes Node.js API (with types) so you can programmaticaly use same function that CLI provides
(only if you want to)</li></ul> <h1 id="encryption"><a href="#encryption" class="header-anchor">#</a> Encryption</h1> <p>Based on
<a href="http://vancelucas.com/blog/stronger-encryption-and-decryption-in-node-js/" target="_blank" rel="noopener noreferrer">Stronger Encryption and Decryption in Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><code>aes-256-cbc</code> algorithm is used by default.</p> <p>Random initialization vector (IV) is used, prepended to the encrypted file (first 16 bytes).</p> <p>Encrypted file is stored in binary format (Buffer), containing concatenated (byte range in
brackets):</p> <ul><li>IV (0, 16)</li> <li>Payload (16, ...)</li></ul> <h1 id="cli-commands"><a href="#cli-commands" class="header-anchor">#</a> CLI commands</h1> <ul><li><code>secrets-gen-key</code>: Generate a <code>SECRET_ENCRYPTION_KEY</code> to be used for encryption/decryption of
secret files.</li> <li><code>secrets-encrypt</code>: Encrypt all files (except already encrypted <code>*.enc</code>) in <code>./secret</code> folder.
<code>.enc</code> is added to the file.</li> <li><code>secrets-decrypt</code>: Decrypt all encrypted files (<code>*.enc</code>) in <code>./secret</code> folder. <code>.enc</code> extension is
removed after encryption, files are overwritten.</li></ul> <h1 id="key"><a href="#key" class="header-anchor">#</a> Key</h1> <p>Commands <code>secrets-encrypt</code> and <code>secrets-decrypt</code> need a key to perform an operation (generate it
with <code>secrets-gen-key</code> first time).</p> <p>Key can be passed in one of the following ways, in order of preference:</p> <ol><li><code>--encKey myKey</code> CLI argument (overrides everything else)</li> <li><code>SECRET_ENCRYPTION_KEY</code> environment variable.</li> <li><code>SECRET_ENCRYPTION_KEY</code> in <code>.env</code> file in your project folder (<code>cwd</code>).</li></ol> <p>Also, you can provide e.g <code>--encKeyVar SECRET_ENCRYPTION_KEY_B</code> - name of env variable to read key
from.</p> <h1 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h1> <p><em>All examples are for global installation. For local installations prepend the command with <code>yarn</code>
(or <code>npm run</code>).</em></p> <h3 id="secrets-gen-key"><a href="#secrets-gen-key" class="header-anchor">#</a> secrets-gen-key</h3> <p>Generate a <code>SECRET_ENCRYPTION_KEY</code> to be used for encryption/decryption of secret files.</p> <p>Keep it secret, provide as env variable <code>SECRET_ENCRYPTION_KEY</code> to the following commands.</p> <h3 id="secrets-encrypt"><a href="#secrets-encrypt" class="header-anchor">#</a> secrets-encrypt</h3> <p>Encrypt all files (except already encrypted <code>*.enc</code>) in <code>./secret</code> folder (and its subfolder).
<code>.enc</code> is added to the file.</p> <p>Example: <code>secret1.json</code> will become <code>secret1.json.enc</code>.</p> <p>Options:</p> <ul><li><code>--pattern</code> - directory (pattern) to encrypt (default to <code>./secret</code>). Can provide many like
<code>--pattern p1 p2</code> or <code>--pattern p1 --pattern p2</code>. Supports <code>globby</code> pattern, e.g
<code>--pattern ./secret/**/*.txt</code>.</li> <li><code>--encKey</code> - provide encryption key</li> <li><code>--encKeyVar</code> - read encryption key from env variable with this name (default
<code>SECRET_ENCRYPTION_KEY</code>).</li> <li><code>--algorithm</code> - encryption algorithm to use (default <code>aes-256-cbc</code>).</li> <li><code>--del</code> - delete source files after successful encryption. Be careful!</li> <li><code>help</code> - list possible options</li></ul> <h3 id="secrets-decrypt"><a href="#secrets-decrypt" class="header-anchor">#</a> secrets-decrypt</h3> <p>Decrypt all encrypted files (<code>*.enc</code>) in <code>./secret</code> folder (and its subfolders). <code>.enc</code> extension is
removed after encryption, files are overwritten.</p> <p>Example: <code>secret1.json.enc</code> will become <code>secret1.json</code>.</p> <p>Options: same as <code>secrets-encrypt</code>.</p> <p>Except <code>--dir</code> is used instead of <code>--pattern</code>. Example: <code>--dir ./secret</code> will decrypt all
<code>./secret/**/*.enc</code>.</p> <h1 id="gitignore"><a href="#gitignore" class="header-anchor">#</a> .gitignore</h1> <p>Use <a href="https://github.com/NaturalCycles/dev-lib" target="_blank" rel="noopener noreferrer">dev-lib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <code>yarn update-from-dev-lib</code>.</p> <p>Otherwise, this is the right config for <code>.gitignore</code>:</p> <div class="language- extra-class"><pre class="language-text"><code># All secrets are ignored, except encrypted
/secret/**/*.*
!/secret/**/*.enc
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs-lib/exec.html" class="prev">
        Exec
      </a></span> <span class="next"><a href="/nodejs-lib/security.html">
        Security
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nodejs-lib/assets/js/app.b32b6a46.js" defer></script><script src="/nodejs-lib/assets/js/2.23454914.js" defer></script><script src="/nodejs-lib/assets/js/15.f2620e00.js" defer></script>
  </body>
</html>
