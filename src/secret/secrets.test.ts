import * as fs from 'fs-extra'
import { secretDir } from '../test/paths.cnst'
import { secretsDecrypt } from './secrets-decrypt.util'
import { secretsEncrypt } from './secrets-encrypt.util'

beforeAll(() => {
  jest.spyOn(fs, 'writeFileSync').mockImplementation()
  jest.spyOn(fs, 'unlinkSync').mockImplementation()
})

// It's ok to share it here, it's only used for dummy testing
const SECRET_ENCRYPTION_KEY =
  'LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcjFXNkRwd2pCSk5zcWU1TnlKTHBIa01UaEpjM05BbUV5Y21kNnphYTQ2TVZzbUlzCnZyUUlrREI4S3d1d3NUeTNjRElpVjZteHJ2MS9kcUFwWCtPRHFoOFhJNmM2Y1cwVnFNRWZUeGIzbWpxVU53VUUKODYvN0Y0NitoRHB3SWpwTGlPaklSamhnK1h1Ny9HRFN0bjJuYTVIL0hTYTNXTGFzMmdpaVB0QUYvMGJOcmNLNQptMnBYS1B0TzZBTjBNd3FvVS9wU0RSMHc3RmtTc2VZZDI3d0kzeDhSSE9UOG1vbG1qekhCTDZjVjVFNWpobklvCmRLYzV0U0s4eEtIVXl6Yys0eHpNQllHZ0t5UE1HUXNHaUJieGZYMWFIam1DekRNaHRNSlJ2c2tnUTZEdXFSaHkKYXRiRmFYa0loQ0VvN2E3UlZtdVZjbkt0QVYxYStwVWwzbHZtblFJREFRQUJBb0lCQUMyaU1UK1dNYU1DUDdqbQpsZ1lLL25OcTM4eVZrcitQYnFrYU9XaTdtSXFBcXFmMzEwOTNDZmVGTnZ2NUdlNjNMOE1hdVVkNW1nNUNXZ2RrCjNmL2Y5aWV6MmREa3VGaEhIT2tFQW9NU0pqVlU0N2lDTE96RHM2VkkrSnJ2bnJtNTFHajR0UTlab3h1cnNaeVoKRXA1K2k3RjZtUnhjTkVINW9YbEozL2hiS2dScldjZGFEeStDOE9iYjdJZ1BleFBJS1VGRGxRclVjWk94OTR4UQpuT1g2VkU1bWpKcjlBWHRoVU9RUUcvRElEUS9LcW4yZzhuczBUOFR6MjJhK3lzejE2ZTJBM2Z3T0pLVDFxQkErCkoyMmRRclY1ZGUxTVV0MVpQSDVRcjhDRnlXektPd2gyRlo3Y0xoRDlzbTczYmlHcFdSVVdNczFzNVM5VDFGeFAKNHlEYitzRUNnWUVBMjgySDhxOWQvai9Sb3dVV09ha2plY1JQZ240L3A4T3dFMEVBOTZnaitSTmM0VFBFKy9rYwplbmQ5ZVJzbE8vZy9aOWJBbGY2RFJSdWhCNnZEL2N6QmFIY1ovcm9aYlV4V2dYV0NsTDJPMkhIcmNpWWhzNWwyClQyZlBNQ3dLWi9WcUM0R1JFNlpremtpdnVlOENRU0U0N1BXMkhCd1VlenFGQWlWN1JlWXJmVTBDZ1lFQXpEV0MKcFFvUU5wcTNTU2ttdVdMM3FTRVdTRFNKYzdsL3dEUzVQd1JJcGIvNm9rLzRGbm9tdVRGdHhZWFdLQWRaR3h3VQpGaFZ4bkI3YzRQVTd4UlBhQ1Rnc3RwNHRUMU1zWHJ5WUN4T1JVcjNwMWJ6R2tOOXdXd1VPYW1RdU9BakNubjdCCnBaK1NnVCt0YWpBczg3TDBNVVpaaUpkMjM4L2RjSWRhY3lsaXBwRUNnWUFLNW14aGVwVGNzT21DZmhRV0UrOHcKY0szSXVONExRY2NQalYrdzZHT3dUR2VFdTM1L1NHRkRLWDNOYmEweEJpU096N1dKT3EvajAzVHUzbk8vdUZHMwpEb0Q1Z3QwVDhIOHh1RlFiY0RNUFJNYjZTQzNQckVLVHVZQXEwV1JLdDM3a3h5NGNuVm5PYVFoZDNoNXNnR3RFClJRTWM3YitPUk42bnRwZ2daVU91MlFLQmdRQzZDS1dVSks3UWovSVp2RnVDMkI0Mi9lV0dzaFhtVHorS29uMkEKWXk2cmtWR0xQTDhOK3duNy9JTzhSa2pxL29hMm84WEl1SkJmWWQ1bk1nSFpjRlJad2NzNk1xK2tiR2tuaFRnZQpIeDFzKzRaaktTN2NIRElIT1h3QWdITjZxTUJrRTZYbWRKRExIbStsSlc1T05PRXhZcDErU2o0SmR4eU12MEl2ClY2eC9nUUtCZ0gyVTBjb0lzRUxqMzBBVVZreHhSd3NxMGplY21nY1RkbDRhOXBuY0lpNmp1TWVhMVc1V1E5WVgKTXY5SjZXYjk3RXVJYlBLVi95UTFlb2g5bHRJK1EyMjBEaFVXSDY1YkZNcmRBUEFpTkN5SzhqM1dIaTNsd2IyOQo2eHAvdkd4ZStaNDkzRFBzeFFzcWpzbm0wWVJEKzZIWVNEZngrZnp6SjdGZEZaREJuNUFDCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg=='

test('secrets', async () => {
  secretsDecrypt([secretDir], SECRET_ENCRYPTION_KEY)
  secretsDecrypt([secretDir], SECRET_ENCRYPTION_KEY, undefined, true)

  secretsEncrypt([secretDir], SECRET_ENCRYPTION_KEY)
  secretsEncrypt([secretDir], SECRET_ENCRYPTION_KEY, undefined, true)
})
